@*
    Layout for Authentication Panel.
    - Logins
    - Registering
    - Forgot Password
    - Login with OAuth
    - Verify Email
    - Etc.
*@

@model Goliath.Models.AuthModel;

@{
    Layout = "_Layout";
}

@section UniqueHeader {
    <link href="~/css/login-style.css" rel="stylesheet" />
}

<div id="ZoomDiv">

    <div class="container parent-container">

        @RenderSection("AuthBanner")

        <div class="alert alert-primary alert-dismissible fade show hide" role="alert" id="ChangedGraphicAlert" style="z-index: 3;">
            <button type="button" class="close" data-hide="alert" aria-label="Close">
                <span aria-hidden="true">×</span>
            </button>
            <strong>You changed the view.</strong> Your data is saved; You can undo this anytime.
        </div>

        <div class="row">

            <!-- The image half -->
            <div class="col-md d-none d-md-flex bg-dark round-left" id="LeftContainer">

                <div class="container h-100">
                    <div class="row align-items-center h-100">

                        <div class="col-12 mx-auto">
                            <div id="carouselExampleControls" class="carousel slide h-100" data-ride="carousel">
                                <ol class="carousel-indicators">
                                    <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                                    <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                                    <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                                </ol>

                                <div class="carousel-inner" role="listbox">
                                    <div class="carousel-item active">
                                        <img class="d-block img-fluid round" src="~/images/800x800.png" alt="First slide">
                                    </div>
                                    <div class="carousel-item">
                                        <img class="d-block img-fluid round" src="~/images/800x800.png" alt="Second slide">
                                    </div>
                                    <div class="carousel-item">
                                        <img class="d-block img-fluid round" src="~/images/800x800.png" alt="Third slide">
                                    </div>
                                </div>
                                <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Previous</span>
                                </a>
                                <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Next</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- The content half -->
            <div class="col-md-6 bg-light round-right" id="RightContainer">
                <!--<div class="container bg-light round parent-container" style="min-height: 100%;zoom: 1.15; margin-top: 3%" id="RightContainer">-->

                <div class="d-flex align-items-center py-5">

                    <!-- Header content-->
                    <div class="container-fluid">
                        <div class="row justify-content-md-center">
                            <div class="col-lg-10 col-xl-9 mx-auto">
                                <div class="text-center">
                                    <!-- Radio Buttons -->
                                    <div class=" ht-tm-element btn-group btn-group-toggle" data-toggle="buttons">

                                        <a asp-controller="Home" asp-action="Index" class="btn btn-outline-primary">

                                            <input type="radio" name="options" id="LoginRadioBtn" autocomplete="off">
                                            Login
                                        </a>
                                        <a asp-controller="Home" asp-action="Register" class="btn btn-outline-primary">

                                            <input type="radio" name="options" id="RegisterRadioBtn" autocomplete="off">
                                            Register
                                        </a>
                                        <div class="btn-group btn btn-outline-primary" id="OtherHead">
                                            <a id="OtherDrop" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <input type="radio" name="options" id="OtherRadioBtn" autocomplete="off">
                                                Other
                                            </a>
                                            <div class="dropdown-menu" aria-labelledby="OtherDrop" x-placement="bottom-start" style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 38px, 0px);">

                                                <a asp-controller="Home" asp-action="ForgotPassword" id="Forgot_Password" class="dropdown-item">Forgot Password</a>
                                                <a asp-controller="Home" asp-action="VerifyEmail" id="Verify_Email" class="dropdown-item">Verify Email</a>
                                                <div class="dropdown-divider"></div>
                                                <a class="dropdown-item py-xl-1" href="#!"><i class="fab fa-google px-sm-1"></i>Sign in with Google</a>
                                                <a class="dropdown-item" href="#!"><i class="fab fa-microsoft px-sm-1"></i>Sign in with Microsoft</a>
                                                <a class="dropdown-item" href="#!"><i class="fab fa-github px-sm-1"></i>View GitHub</a>
                                            </div>
                                        </div>
                                        <a class="btn btn-outline-primary bg-primary" id="ShowGraphic" onclick="toggleGraphic(true)">
                                            <i class="fas fa-eye text-white" id="ShowGraphicIcon"></i>
                                        </a>
                                    </div>
                                    <!-- Radio Buttons End -->
                                    <hr />
                                    <div>
                                        <!-- Right Panel Header -->
                                        @RenderSection("AuthHeader")
                                    </div>
                                </div>
                                <div>
                                    <!-- Right Panel Body -->
                                    @RenderBody()
                                </div>
                            </div>
                        </div>
                    </div><!-- End -->
                </div>
            </div><!-- End -->
        </div>
    </div>
</div>
<script>
    //TODO: Move most of this to scripts.js

    // Hide the notification area.
    $("#ChangedGraphicAlert").hide();

    // Don't delete the notification when it is closed just hide it.
    $(function () {
        $("[data-hide]").on("click", function () {
                $(this).closest("." + $(this).attr("data-hide")).hide();
        });
    });

    // Save the information if the user prefers hidden mode.
    if (localStorage.getItem("graphic") == null) {
        localStorage.setItem("graphic", "enabled");
    }
    if (localStorage.getItem("graphic") == "disabled") {
        toggleGraphic(false);
    }
    // Change the layout.
    function toggleGraphic(alert) {
        
        if ($("#ShowGraphicIcon").hasClass("fas fa-eye-slash")) {
            localStorage.setItem("graphic", "enabled");
            $("#ShowGraphicIcon").attr("class", "fas fa-eye text-white");
            $("#RightContainer").attr("class", "col-md-6 bg-light round-right");
            $("#RightContainer").attr("style", "");
            $("#LeftContainer").removeClass("invisible");
        } else {
            localStorage.setItem("graphic", "disabled");
            $("#ShowGraphicIcon").attr("class", "fas fa-eye-slash text-white");
            $("#LeftContainer").addClass("invisible");
            $("#RightContainer").attr("class", "container bg-light round parent-container");
            $("#RightContainer").attr("style", "min-height: 100%;zoom: 1.15; margin-top: 3%");
        }
        if (alert) {
            $("#ChangedGraphicAlert").show();
        }
    }

    // This fixes a bug where the other dropdown radio button could be "clicked" even if the dropdown did not open.
$("#OtherHead").click(function (e) {
    if (e.target.id != "OtherDrop") {
        $("#OtherDrop").trigger("click");
        e.stopImmediatePropagation();
    }
});

// Indicate to the user what they have just clicked on.
if ($("#" + "@Model.SelectedValue.ToString()RadioBtn").length == 0) {
    $("#OtherRadioBtn").prop("checked", true);

    $("#@Model.SelectedValue.ToString()").css({
        "background-color": "#0094ff",
        "font-weight": "bold"
    });
} else {
    $("#@Model.SelectedValue.ToString()RadioBtn").prop("checked", true);
    }
    /**
     * Return the mathmatical difference between uwh and cwh as well as uww and cww.
     * It ends up returning the lowest of the two as a raw percentage.
     */
    function calculateDifference(uwh, uww, cwh, cww) {
        var whdiff = uwh - cwh;
        var wwdiff = uww - cww;
        var calcA = whdiff / uwh;
        var calcB = wwdiff / cwh;
        return calcA < calcB ? (1 - calcA) : (1 - calcB);
    }
    /**
     * Adjusts the viewport for any screen to match the developers computer. This ensures proper scaling without HTML/CSS nonsense.
    */
    function adjustViewport() {
        var usualWindowHeight = 969;
        var usualWindowWidth = 1920;
        var currWindowHeight = $(window).height();
        var currWindowWidth = $(window).width();

        $("#ZoomDiv").css({
            "zoom": String(calculateDifference(usualWindowHeight, usualWindowWidth, currWindowHeight, currWindowWidth))
        });
        //alert("Your calculated zoom: " + String(calculateDifference(usualWindowHeight, usualWindowWidth, currWindowHeight, currWindowWidth)));
    }

    // When the window loads account for screen size.
    $(window).on("load", adjustViewport());
</script>